<!DOCTYPE html>
<html>
<% include ../partials/head %>
<% include ../partials/menu %>
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
<script src="https://code.highcharts.com/mapdata/countries/es/es-all.js"></script>
<body>
<div class="container" style="margin-top: 20px;">
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-block">
                    <h4 class="card-title">
                        <b><span class="fa fa-list"></span> Data</b>
                        <hr>
                    </h4>
                    <div class="card-text">

                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card myCard">
                <div class="card-block">
                    <h4 class="card-title"><span class="fa fa-bar-chart-o"></span> Chart</h4>
                    <hr>
                    <div id="container"></div>
                </div>
                <hr>
                <div class="card-footer text-xs-right">
                    <span class="fa fa-database"></span> This result is now stored in your own results!<br>
                    <small><a href="/users/profile">See my own results</a></small>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    jQuery.noConflict();
    var global = <%- JSON.stringify(global) %>;
    var colors = <%- JSON.stringify(colors) %>;
    function getParties(chartCode){
        for(var g of global){
            if(g.cc === chartCode){
                return JSON.stringify(g.parties,null,2);
            }
        }
    }
    function getColor(parties){
        var mayor = {
            party: '',
            mandates: 0
        };
        var ps = JSON.parse(parties);
        Object.keys(ps).forEach(function(key){
            console.log(ps[key]);
           if(parseInt(ps[key]) >= mayor.mandates){
               mayor.party = key;
               mayor.mandates = ps[key];
           }
        });

        return colors[mayor.party];
    }
    var options = {
        chart: {
            borderWidth: 1
        },

        title: {
            text: 'Nordic countries'
        },
        subtitle: {
            text: 'Demo of drawing all areas in the map, only highlighting partial data'
        },

        legend: {
            enabled: false
        },

        series: [{
            name: 'Country',
            mapData: Highcharts.maps['countries/es/es-all'],
            data: [{
                'hc-key': 'es-c',
                value: 0,
                parties: getParties('es-c'),
                color: getColor(getParties('es-c'))
            }, {
                'hc-key': 'es-vi',
                value: 0,
                parties: getParties('es-vi'),
                color: getColor(getParties('es-vi'))
            }, {
                'hc-key': 'es-ab',
                value: 0,
                parties: getParties('es-ab'),
                color: getColor(getParties('es-ab'))
            }, {
                'hc-key': 'es-a',
                value: 0,
                parties: getParties('es-a'),
                color: getColor(getParties('es-a'))
            }, {
                'hc-key': 'es-o',
                value: 0,
                parties: getParties('es-o'),
                color: getColor(getParties('es-o'))
            }, {
                'hc-key': 'es-av',
                value: 0,
                parties: getParties('es-av'),
                color: getColor(getParties('es-av'))
            }, {
                'hc-key': 'es-ba',
                value: 0,
                parties: getParties('es-ba'),
                color: getColor(getParties('es-ba'))
            }, {
                'hc-key': 'es-pm',
                value: 0,
                parties: getParties('es-pm'),
                color: getColor(getParties('es-pm'))
            }, {
                'hc-key': 'es-b',
                value: 0,
                parties: getParties('es-b'),
                color: getColor(getParties('es-b'))
            }, {
                'hc-key': 'es-bi',
                value: 0,
                parties: getParties('es-bi'),
                color: getColor(getParties('es-bi'))
            }, {
                'hc-key': 'es-bu',
                value: 0,
                parties: getParties('es-bu'),
                color: getColor(getParties('es-bu'))
            }, {
                'hc-key': 'es-cc',
                value: 0,
                parties: getParties('es-cc'),
                color: getColor(getParties('es-cc'))
            }, {
                'hc-key': 'es-ca',
                value: 0,
                parties: getParties('es-ca'),
                color: getColor(getParties('es-ca'))
            }, {
                'hc-key': 'es-s',
                value: 0,
                parties: getParties('es-s'),
                color: getColor(getParties('es-s'))
            }],
            dataLabels: {
                enabled: true,
                color: '#FFFFFF',
                formatter: function () {
                    if (this.point.value) {
                        return this.point.name;
                    }
                }
            },
            tooltip: {
                useHTML: true,
                headerFormat: '',
                pointFormat: '{point.name}<br>{point.parties}'
            }
        }]
    };
    (function ($) {
        $(function () {

            $('#container').highcharts('Map', options);
        });
    })(jQuery);

</script>
</body>
</html>
